# Петров Константин Сергеевич БПИ233-2
## Большое домашнее задание 2. Симулятор жидкостей

### Реализованные пункты решения:

1. Ввод из файла
2. Написанный шаблон Fixed
3. Шаблонный класс симулятора с выбором типов, размеров\
и возможностью использовать динамический размер
4. Выбор типов и размеров в рантайме без потери производительности(виртуальных чисел)
5. Возможность сохранить положение жидкостей и настройки симулятора\
с последующей возможностью использовать их как входные данные


### Как использовать скомпилированную программу:
Программа принимает параметры как аргументы командной строки\
**Обязательные флаги:**\
**--p-type --v-type --vf-type** Используются в виде {flag}={type}\
Например --v-type="FIXED(64, 32)". При этом типы FIXED и FAST_FIXED требуют кавычки\
либо вокруг самого типа, либо вокруг всех аргументов в целом\
**--in-file** Путь до файла с параметрами симуляции\
**Необязательные флаги:**\
**--out-file** Путь до файла, в который будет симулятор будет сохранять состояние жидкостей\
**--n-ticks** Число, означающее количество тиков, раз в которое симулятор будет сохранять состояние\
<ins>Оба флага используются вместе</ins>\
Пример корректного вызова программы:\
./main --p-type=DOUBLE --v-type="FIXED(32,16)" --vf-type="FAST_FIXED(48,16)" --in-file=../TestField.txt --out-file=../test_out.txt --n-ticks=100

### Как скомпилировать программу
Нужны установленные make и cmake

> mkdir ./build

> cd ./build

> cmake ..

> make

> вызов программы

### Что вообще творится в программе

При компиляции типы из DTYPES и размеры из DSIZES превращаются в вектор чисел
Рекурсивный шаблон заполняет массив types наборами чисел, соответствующим конкретным наборам типов и размера\
Похожий рекурсивный шаблон заполняет массив simulators функций, создающих конкретную специализацию шаблона SimulatorImpl на основе этих чисел\
В рантайме аргументы преобразуются в такие же числа и выбирается нужная функция\
Функции не получилось склеить, потому что я поймал <span style="color:red">internal compiler error</span>

### Косяки

В общем становится понятно, почему одной из первых частей задания является класс числа с фиксированной точкой\
Некоторые комбинации типов с плавающей точкой плохо работают с симулятором:\
DOUBLE DOUBLE DOUBLE\
DOUBLE DOUBLE FLOAT\
DOUBLE FLOAT FLOAT\
FLOAT DOUBLE FLOAT\
FLOAT FLOAT FLOAT\
FIXED(32,16) DOUBLE FLOAT\
FAST_FIXED(48,16) DOUBLE FLOAT\
Их починка требует разбирательства в том, где возникают ошибки округления, этим я займусь в третьей домашке
